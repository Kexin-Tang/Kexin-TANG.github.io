<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Kexin">
    
    <title>
        
            Redis基础 |
        
        Kexin Tang
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/tumblr-brands.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"kexin-tang.github.io","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true,"init_open":true},"style":{"primary_color":"#ef476f","avatar":"/images/tumblr-brands.svg","favicon":"/images/tumblr-brands.svg","article_img_align":"center","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/sea.jpg","description":"<tag> Too many people, too little soul... </tag>"},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"mac"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.2"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div
        class="header-content">
        <div class="left">
            <a class="logo-title" href="/">
                Kexin Tang
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                                href="/">
                                HOME
                                    <!-- Home -->
                            </a>
                        </li>
                        
                        <li class="menu-item">
                            <a class=""
                                href="/archives">
                                ARCHIVE
                                    <!-- Archive -->
                            </a>
                        </li>
                        
                        <li class="menu-item">
                            <a class=""
                                href="/categories">
                                CATEGORY
                                    <!-- Category -->
                            </a>
                        </li>
                        
                        <li class="menu-item">
                            <a class=""
                                href="/tags">
                                TAG
                                    <!-- Tag -->
                            </a>
                        </li>
                        
                        <li class="menu-item">
                            <a class=""
                                href="/CV/CV.pdf">
                                CV
                                    <!-- CV -->
                            </a>
                        </li>
                        
                        <li class="menu-item">
                            <a class=""
                                href="/about">
                                ABOUT
                                    <!-- About -->
                            </a>
                        </li>
                        
                            
                                <li class="menu-item search search-popup-trigger">
                                    <i class="fas fa-search"></i>
                                </li>
                                
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                    
                        <div class="icon-item menu-bar">
                            <div class="menu-bar-middle"></div>
                        </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/">
                        HOME
                    </a>
                </li>
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/archives">
                        ARCHIVE
                    </a>
                </li>
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/categories">
                        CATEGORY
                    </a>
                </li>
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/tags">
                        TAG
                    </a>
                </li>
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/CV/CV.pdf">
                        CV
                    </a>
                </li>
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                        href="/about">
                        ABOUT
                    </a>
                </li>
                
        </ul>
    </div>

    <div class="window-mask"></div>

</header>
        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">
                Redis基础
            </span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/tumblr-brands.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">
                            Kexin
                        </span>
                        <!-- 
                            <span class="author-label">Lv3</span>
                         -->
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2021-05-17 10:45:38
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Redis/">Redis</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/redis/">redis</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.8k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>11 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
            

                    <div class="article-content markdown-body">
                        <h1 id="NoSQL-数据库"><a href="#NoSQL-数据库" class="headerlink" title="NoSQL 数据库"></a><em>NoSQL</em> 数据库</h1><p><em>NoSQL</em> (No only SQL)是一个高性能的 <em>key-value</em> 非关系型数据库。</p>
<h2 id="Redis-优势"><a href="#Redis-优势" class="headerlink" title="Redis 优势"></a><em>Redis</em> 优势</h2><p><em>Redis</em> 有众多优势：</p>
<ol>
<li><strong>性能好</strong>：可以用于减小CPU压力和数据库的读写压力</li>
<li><strong>数据类型丰富</strong></li>
<li><strong>原子性</strong>：即单个操作是原子性的，要么成功要么完全不执行；多个操作可以使用事务完成原子性操作<blockquote>
<p>注：<em>Redis</em> 支持事务，但是和 <em>MySQL</em> 的事务不同，并不支持ACID特性。</p>
</blockquote>
</li>
<li><strong>持久化数据库</strong>：运行在内存，但是可以将数据持久化到磁盘</li>
</ol>
<p><em>Redis</em> 主要适用于“高并发、大数据、可扩展”的情形，但是不适用于“需要大量事务操作和结构化查询”的任务中。</p>
<h2 id="redis-VS-memcache"><a href="#redis-VS-memcache" class="headerlink" title="redis VS memcache"></a><em>redis</em> VS <em>memcache</em></h2><p><em>Redis</em> 和常用的 <em>memcache</em> 有很大的不同：</p>
<ol>
<li><em>memcache</em> 不能持久化，只能将数据保存在内存中，断电后数据消失</li>
<li><em>memcache</em> 没有数据类型概念，存的是json</li>
<li><em>memcache</em> 使用 “串行+多线程+锁” 的方式实现并发，而 <em>redis</em> 使用 “单线程+多路IO复用” 实现并发</li>
</ol>
<blockquote>
<p>为什么细分类型比使用Json好？</p>
<ul>
<li>如果使用json想要取回某一条数据时，需要返回整个Json，代价高</li>
<li>计算向数据转移：使用json时获取数据需要在client进行解读；而细分数据类型时计算在server端完成，client直接得到计算完的结果<blockquote>
<p>使用json时，类似使用某种未知语言通信，用户看不懂就要放入各种语言的翻译器尝试理解；细分数据类型后，相当于告知会使用什么语言通信，用户直接使用该语言的翻译器就可以理解语义</p>
</blockquote>
</li>
</ul>
</blockquote>
<h2 id="为什么-redis-支持高并发并效率高"><a href="#为什么-redis-支持高并发并效率高" class="headerlink" title="为什么 redis 支持高并发并效率高"></a>为什么 <em>redis</em> 支持高并发并效率高</h2><ol>
<li><em>redis</em> 基于内存，免去了磁盘读写，减小了DB的IO压力</li>
<li><em>redis</em> 单线程，不受CPU的限制，也省去了上下文切换</li>
<li><em>redis</em> 多路复用，可以处理并发请求 (使用了<em>epoll</em>)</li>
</ol>
<hr>
<h1 id="Redis-数据类型和基本操作"><a href="#Redis-数据类型和基本操作" class="headerlink" title="Redis 数据类型和基本操作"></a><em>Redis</em> 数据类型和基本操作</h1><h2 id="数据库设置"><a href="#数据库设置" class="headerlink" title="数据库设置"></a>数据库设置</h2><p><em>Redis</em> 默认有16个库</p>
<ul>
<li><code>select &lt;dbid&gt;</code>来进行数据库切换</li>
<li><code>keys *</code>查看所有的keys</li>
<li><code>exists &lt;key&gt;</code>查看某个key是否存在</li>
<li><code>del &lt;key&gt;</code>删除某个key</li>
<li><code>unlink &lt;key&gt;</code>异步删除某个key</li>
<li><code>type &lt;key&gt;</code>查看key对应数据的数据类型</li>
<li><code>object encoding &lt;key&gt;</code>查看key对应数据的编码方式/实现方式</li>
<li><code>expire &lt;key&gt; &lt;time&gt;</code>设置某个key的生命周期</li>
<li><code>ttl &lt;key&gt;</code>查看当前剩余时间，-1为永不过期，-2为已过期</li>
</ul>
<blockquote>
<ul>
<li>type – 返回value的数据类型，只有String、List、Sorted List、Hash和Set这五种</li>
<li>object – 返回实现方式，比如embstr、int、raw等类型。redis默认会先以节省内存的编码方式创建，当满足一定条件时，会转换为更为通用的编码方式。</li>
</ul>
</blockquote>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><p>是<strong>二进制安全</strong>的一种数据类型，可以存储任何“可转换为string类型”的数据，其底层是SDS(simple dynamic string，简单动态字符串)。该数据结构会预先分配一定的capacity，然后在空间不足时分配更多capacity。</p>
<blockquote>
<p>注：capacity最大为512MB，小于1MB时空间进行翻倍，大于1MB时每次多分配1MB</p>
</blockquote>
<h3 id="二进制安全"><a href="#二进制安全" class="headerlink" title="二进制安全"></a>二进制安全</h3><p>二进制安全指的是<strong>redis基于字节流而非字符流</strong>，所有的内容都会转换成没有实际意义的二进制来存储。比如在C语言中有 “hello\0world”，那么基于字符流时，会识别<code>\0</code>，因此只能保存 “hello”；而基于字节流时，所有内容转换为二进制，<code>\0</code>变为一串01序列，所以可以存储 “hello\0world”。</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><ul>
<li><code>set &lt;key&gt; &lt;value&gt;</code>设置键值对</li>
<li><code>setnx &lt;key&gt; &lt;value&gt;</code>在key不存在时才设置</li>
<li><code>get &lt;key&gt;</code>获取值</li>
<li><code>append &lt;key&gt; &lt;str&gt;</code>将str附加到值的尾部</li>
<li><code>strlen &lt;key&gt;</code>获取值的长度<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> k1 100</span><br><span class="line">&gt; strlen k1</span><br><span class="line">3</span><br><span class="line">&gt; append k1 A</span><br><span class="line">&gt; strlen k1</span><br><span class="line">4   <span class="comment"># “100A”</span></span><br><span class="line">&gt; <span class="built_in">set</span> k2 中</span><br><span class="line">&gt; get k2</span><br><span class="line"><span class="comment"># 此处的返回要根据预设的编码方式决定</span></span><br><span class="line"><span class="comment"># 如果是GKB，则是2个hex</span></span><br><span class="line"><span class="comment"># 如果是UTF8，则是3个hex</span></span><br><span class="line"><span class="comment"># 如果设置了`redis-cli --raw`，则返回&quot;中&quot;</span></span><br><span class="line">&gt; strlen k2</span><br><span class="line"><span class="comment"># 同上，需要根据编码方式决定</span></span><br></pre></td></tr></table></figure></li>
<li><code>incr/decr &lt;key&gt;</code>值++/–</li>
<li><code>incrby/decrby &lt;key&gt; &lt;step&gt;</code>值+step/-step</li>
<li><code>mset &lt;k1&gt; &lt;v1&gt; &lt;k2&gt; &lt;v2&gt; ...</code>设置多个键值对(<strong>原子操作，任何一个失败则全部失败，不予设置</strong>)</li>
<li><code>mget &lt;k1&gt; &lt;k2&gt;</code>获取多个值</li>
<li><code>getrange &lt;key&gt; &lt;start&gt; &lt;end&gt;</code>取key[start, end]，注意两边界可取</li>
<li><code>setrange &lt;key&gt; &lt;start&gt; &lt;value&gt;</code>在start处插入一个value</li>
<li><code>getset &lt;key&gt; &lt;value&gt;</code>获取旧值，设置新值</li>
</ul>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>单键多值，底层为双向链表(quickList)，在数据量少时，使用一块连续内存，称为zipList，在数据量多时，将多个zipList作为节点，构建双向链表，称为quickList。</p>
<h3 id="常见操作"><a href="#常见操作" class="headerlink" title="常见操作"></a>常见操作</h3><ul>
<li><code>lpush/rpush &lt;key&gt; &lt;v1, v2, ...&gt;</code>从左侧/右侧压入数据</li>
<li><code>rpoplpush &lt;k1&gt; &lt;k2&gt;</code>从k1的右侧弹出元素放入k2的左侧</li>
<li><code>lrange &lt;key&gt; &lt;start&gt; &lt;end&gt;</code>key[start, end]</li>
<li><code>lindex &lt;key&gt; &lt;index&gt;</code>key[index]</li>
<li><code>llen</code>获取长度</li>
<li><code>linsert &lt;key&gt; before/after &lt;value&gt; &lt;newvalue&gt;</code>在key[value]前/后插入一个newvalue</li>
<li><code>lrem &lt;key&gt; &lt;n&gt; &lt;value&gt;</code></li>
<li><code>blpop &lt;key&gt; &lt;timeout&gt;</code> – 在timeout时间内阻塞等待弹出</li>
</ul>
<h3 id="可实现的数据类型"><a href="#可实现的数据类型" class="headerlink" title="可实现的数据类型"></a>可实现的数据类型</h3><ul>
<li>栈 – 通过同向插入删除即可</li>
<li>队列 – 通过反向插入删除即可</li>
<li>数组 – 使用<code>LSET</code>和<code>LINDEX</code>对单数据操作</li>
<li>阻塞单播队列 – 使用<code>BLPOP</code>和<code>BRPOP</code>这种阻塞操作实现</li>
</ul>
<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>与list相似，但是不允许重复，底层是字典(hash表)，增删查改都是O(1)。</p>
<ul>
<li><code>sadd &lt;key&gt; &lt;v1, v2, ...&gt;</code></li>
<li><code>smembers &lt;key&gt;</code></li>
<li><code>sismember &lt;key&gt; &lt;value&gt;</code>if value in key?</li>
<li><code>scard &lt;key&gt;</code>返回个数</li>
<li><code>srem &lt;key&gt; &lt;v1, v2, ...&gt;</code>删除</li>
<li><code>spop &lt;key&gt;</code>随机弹出一个</li>
<li><code>srandmember &lt;key&gt; &lt;n&gt;</code>随机抽取n个</li>
<li><code>smove &lt;k1&gt; &lt;k2&gt;</code>从k1移动一个到k2</li>
<li><code>sdiffstore/sinterstore/sunionstore &lt;destkey&gt; &lt;k1&gt; &lt;k2&gt;</code>将k1与k2进行操作放入destkey</li>
<li><code>sdiff/sinter/sunion &lt;key ...&gt;</code>操作后输出</li>
</ul>
<h2 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h2><p>存储的是 {key: {field: value, field: value}} 的结构。</p>
<h3 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h3><ul>
<li><code>hset &lt;key&gt; &lt;field&gt; &lt;value&gt;</code></li>
<li><code>hget &lt;key&gt; &lt;field&gt;</code></li>
<li><code>hmset &lt;key&gt; &lt;field1&gt; &lt;value1&gt; &lt;field2&gt; &lt;value2&gt;...</code></li>
<li><code>hexists &lt;key&gt; &lt;field&gt;</code></li>
<li><code>hvals/hkeys &lt;key&gt;</code>查看所有value/key</li>
</ul>
<h2 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h2><p>与set类似，但是是有序的，因为其为每个成员设置了一个score用于排序。底层使用了两种数据结构：</p>
<ol>
<li>hash: {key: {value: score}}</li>
<li>跳表</li>
</ol>
<ul>
<li><code>zadd &lt;key&gt; &lt;s0&gt; &lt;value0&gt; &lt;s1&gt; &lt;value1&gt; ...</code></li>
<li><code>zrange &lt;key&gt; &lt;start&gt; &lt;end&gt; [withscores]</code></li>
<li><code>zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [withscores]</code>从大到小排序</li>
<li><code>zrevrangebyscore ...</code>反序</li>
<li><code>zcount &lt;key&gt; &lt;min&gt; &lt;max&gt;</code>范围内的元素个数</li>
<li><code>zrank &lt;key&gt; &lt;value&gt;</code>返回排名，从0开始计数</li>
<li><code>zrem &lt;key&gt; &lt;value&gt;</code>删除</li>
</ul>
<h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><p>实际上是字符串，但可以视为只能存储0和1，其下标被称为“偏移量”，用于提高内存使用率。</p>
<h3 id="基本操作-2"><a href="#基本操作-2" class="headerlink" title="基本操作"></a>基本操作</h3><ul>
<li><code>setbit &lt;key&gt; &lt;offset&gt; &lt;value&gt;</code>(<strong>注意是从最左边开始算offset，且STRLEN返回的是字节数而非比特数</strong>)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; setbit k1 1 1</span><br><span class="line">01000000            <span class="comment"># 从左边开始算偏移</span></span><br><span class="line">&gt; STRLEN k1</span><br><span class="line">1                   <span class="comment"># 返回字节数</span></span><br><span class="line">&gt; setbit k1 1 9</span><br><span class="line">0100000001000000    <span class="comment"># 仍然是从最左边开始算偏移 </span></span><br><span class="line">&gt; STRLEN k1</span><br><span class="line">2                   </span><br></pre></td></tr></table></figure></li>
<li><code>getbit &lt;key&gt; &lt;offset&gt;</code></li>
<li><code>bitop and/or/not/xor &lt;destkey&gt; &lt;key&gt; [key...]</code></li>
<li><code>bitcount &lt;key&gt; [start] [end]</code>用于记录为1的个数，注意此处是针对8个bits，即一个byte为单位</li>
<li><code>bitpos &lt;key&gt; &lt;bit&gt; [start] [end]</code>用于查询第start~第end个字节内第一个<code>bit</code>元素的偏移量(<strong>仍然是从最左边开始计算偏移量</strong>)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> k1 1 1</span><br><span class="line">&gt; <span class="built_in">set</span> k1 9 1</span><br><span class="line">&gt; get k1</span><br><span class="line">01000000 01000000</span><br><span class="line">&gt; bitpos k1 1 0 0</span><br><span class="line">1   <span class="comment"># 第0个字节内第一个1的偏移量</span></span><br><span class="line">&gt; bitpos k1 1 1 1</span><br><span class="line">9   <span class="comment"># 第1个字节内第一个1的偏移量，注意仍然是从最左侧计算偏移，所以是9而非1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li>统计登录天数</li>
</ul>
<p>每一个key代表一个用户，value中保存了365个bit，用于代表每一天。该用户在第i天登录，那么<code>setbit user i 1</code>，即把第i个bit设置为1代表登录了。</p>
<p>如果想要知道某个用户user的登录天数，那么只需要<code>bitcount user 0 -1</code>即可。</p>
<ul>
<li>统计活跃用户</li>
</ul>
<p>每一个key代表一天，value中每一个bit代表一个用户。如果用户i在当天登录，那么<code>setbit date i 1</code>。</p>
<p>如果定义每一天都登录的为活跃用户，那么只需要<code>bitop and [date ...]</code>，再统计最后结果中有多少个为1即代表由多少活跃用户。</p>
<h2 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h2><p>用于做基数统计。在输入数据巨大时，计算基数所需的空间总是固定且较小的，比如在Redis中可以用12KB计算2<sup>64</sup>个基数。</p>
<blockquote>
<p>基数：不重复的数字个数</p>
</blockquote>
<ul>
<li><code>pfadd &lt;key&gt; &lt;element ...&gt;</code></li>
<li><code>pfcount &lt;key&gt;</code></li>
<li><code>pfmerge &lt;destkey&gt; &lt;key1, key2 ...&gt;</code>将多个Log进行合并</li>
</ul>
<h2 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h2><p>主要用于保存地理信息，可以计算直线距离等</p>
<hr>
<h1 id="redis-benchmark-压测"><a href="#redis-benchmark-压测" class="headerlink" title="redis-benchmark 压测"></a><em>redis-benchmark</em> 压测</h1><p>使用<code>redis-benchmark</code>可以进行压力测试。</p>
<ul>
<li><code>-h</code> – 测试的主机ip</li>
<li><code>-p</code> – 端口</li>
<li><code>-c</code> – 并发数(concurrency)</li>
<li><code>-n</code> – 请求数</li>
</ul>
<hr>
<h1 id="Lua脚本"><a href="#Lua脚本" class="headerlink" title="Lua脚本"></a>Lua脚本</h1><p>Lua是一种非常轻量级的脚本语言，一般使用C语言编写，其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。</p>
<h2 id="为什么要使用Lua"><a href="#为什么要使用Lua" class="headerlink" title="为什么要使用Lua"></a>为什么要使用Lua</h2><ol>
<li>减少网络开销(类似pipeline)：多个请求通过脚本一次发送，减少网络延迟</li>
<li>原子操作(类似事务)：将脚本作为一个整体执行，中间不会插入其他命令，无需使用事务</li>
<li>复用：客户端发送的脚本永久存在redis中，其他客户端可以复用脚本</li>
<li>可嵌入性：可嵌入JAVA，C#等多种编程语言，支持不同操作系统跨平台交互</li>
</ol>
<h2 id="如何使用Lua"><a href="#如何使用Lua" class="headerlink" title="如何使用Lua"></a>如何使用Lua</h2><ol>
<li><code>EVAL script numkeys key [key ...] arg [arg ...]</code></li>
</ol>
<p>其中script是脚本的内容或路径，numkeys为传入的key的个数，然后key和arg分别对应Lua脚本中的 <em>KEYS[1] KEYS[2] …</em> 和 <em>ARGV[1] ARGV[2] …</em></p>
<ol start="2">
<li><code>SCRIPT LOAD script</code></li>
</ol>
<p>返回脚本的SHA1校验和，不执行</p>
<ol start="3">
<li><code>EVALSHA sha1 numkeys key [key ...] arg [arg ...]</code></li>
</ol>
<p>根据传入的 <em>sha1</em> 校验和执行脚本</p>
<hr>
<h1 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h1><p>ACL(Access Control List)访问控制列表：允许设置可执行的命令和可访问的键来限制用户操作，从而对用户进行更细粒度的权限控制</p>
<ul>
<li><code>acl list</code> – 列出用户信息和权限</li>
<li><code>acl setuser</code> – 新建用户，并可以设置其权限</li>
<li><code>acl cat</code> – 查看指令</li>
<li><code>acl whoami</code> – 显示当前用户</li>
<li><code>auth &lt;username&gt; &lt;password&gt;</code> – 切换用户</li>
</ul>
<hr>

                    </div>

                    

                            
                                <div class="article-nav">
                                    
                                        <div class="article-prev">
                                            <a class="prev" rel="prev" href="/2021/05/17/BIO%E3%80%81NIO%E5%92%8CAIO/">
                                                <span class="left arrow-icon flex-center">
                                                    <i class="fas fa-chevron-left"></i>
                                                </span>
                                                <span class="title flex-center">
                                                    <span class="post-nav-title-item">
                                                        BIO、NIO和AIO
                                                    </span>
                                                    <span class="post-nav-item">
                                                        Prev posts
                                                    </span>
                                                </span>
                                            </a>
                                        </div>
                                        
                                            
                                                <div class="article-next">
                                                    <a class="next" rel="next" href="/2021/05/12/ab%E5%B9%B6%E5%8F%91%E6%B5%8B%E8%AF%95/">
                                                        <span class="title flex-center">
                                                            <span class="post-nav-title-item">
                                                                ab并发测试
                                                            </span>
                                                            <span class="post-nav-item">
                                                                Next posts
                                                            </span>
                                                        </span>
                                                        <span class="right arrow-icon flex-center">
                                                            <i class="fas fa-chevron-right"></i>
                                                        </span>
                                                    </a>
                                                </div>
                                                
                                </div>
                                

                                    
    </div>
</div>

                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Kexin</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.2</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL-%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">NoSQL 数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-%E4%BC%98%E5%8A%BF"><span class="nav-text">Redis 优势</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redis-VS-memcache"><span class="nav-text">redis VS memcache</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-redis-%E6%94%AF%E6%8C%81%E9%AB%98%E5%B9%B6%E5%8F%91%E5%B9%B6%E6%95%88%E7%8E%87%E9%AB%98"><span class="nav-text">为什么 redis 支持高并发并效率高</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">Redis 数据类型和基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E7%BD%AE"><span class="nav-text">数据库设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String"><span class="nav-text">String</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8"><span class="nav-text">二进制安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List"><span class="nav-text">List</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E6%93%8D%E4%BD%9C"><span class="nav-text">常见操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">可实现的数据类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set"><span class="nav-text">Set</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash"><span class="nav-text">Hash</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-1"><span class="nav-text">基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zset"><span class="nav-text">Zset</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bitmaps"><span class="nav-text">Bitmaps</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-2"><span class="nav-text">基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">使用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HyperLogLog"><span class="nav-text">HyperLogLog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GEO"><span class="nav-text">GEO</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#redis-benchmark-%E5%8E%8B%E6%B5%8B"><span class="nav-text">redis-benchmark 压测</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lua%E8%84%9A%E6%9C%AC"><span class="nav-text">Lua脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8Lua"><span class="nav-text">为什么要使用Lua</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Lua"><span class="nav-text">如何使用Lua</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="nav-text">权限控制</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
